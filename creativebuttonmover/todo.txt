Backport latest features from 1.16 branch